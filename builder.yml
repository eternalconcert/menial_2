job: build
image: cloud.canister.io:5000/eternalconcert/builder-default
env:
  DOCKER_USERNAME: ${DOCKER_USERNAME}
  DOCKER_PASSWORD: ${DOCKER_PASSWORD}
  MAJOR_VERSION: 2.0.
stages:
  - name: build
    run: |
      docker login docker.softcreate.de --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
      #export MENIAL_VERSION=$MAJOR_VERSION$BUILDER_RUN
      #export DEBIAN_FRONTEND=noninteractive
      #apt-get update
      #apt-get install wget build-essential libssl-dev pkg-config -y
      #wget https://sh.rustup.rs -O rustup.sh
      #sh rustup.sh -y
      #source $HOME/.cargo/env
      #cargo build --release
      #cp target/release/main /out/
      #./deployment/generate_index.sh $BUILDER_RUN $MAJOR_VERSION$BUILDER_RUN
      #docker build . -t menial_2 --no-cache
      #docker tag menial_2 docker.softcreate.de/menial_2:latest
      #docker tag menial_2 docker.softcreate.de/menial_2:$BUILDER_RUN
      #docker push docker.softcreate.de/menial_2:latest
      #docker push docker.softcreate.de/menial_2:$BUILDER_RUN
  - name: website
    run: |
      apt-get update
      apt-get install -y curl
      curl -s --compressed "https://eternalconcert.github.io/ppa/KEY.gpg" | apt-key add -
      curl -s --compressed -o /etc/apt/sources.list.d/github_ppa.list "https://eternalconcert.github.io/ppa/files.list"
      apt-get update
      apt-get install -y anvil


